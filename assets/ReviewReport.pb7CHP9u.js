import{j as e}from"./ui.CMOn6A-A.js";import{D as m}from"./DashboardLayout.BMyonFam.js";import{t as x,e as u,B as v,C as r,g as S,L as D,I as P}from"./index.DqphIITB.js";import{T as q}from"./textarea.AJv3m7IY.js";import{h as I,u as O,a as w}from"./vendor.DqptLLSw.js";import{T,n as j,M as V,l as L}from"./icons.2ttFni2B.js";import"./trpc.DEyng-9d.js";function K(){const z=I(),[,f]=O(),c=z.reportId||"",[N,h]=w.useState({}),[b,E]=w.useState(new Set),[B,M]=w.useState(!1),y=x.useUtils(),{data:a}=x.technicalReports.generate.get.useQuery({reportId:c},{enabled:!!c,refetchInterval:s=>s?.status==="parsing"?5e3:!1,refetchOnWindowFocus:!1,staleTime:3e4}),{data:i,isLoading:n,error:k}=x.technicalReports.uploads.getReviewFields.useQuery({reportId:c},{enabled:!!c&&a?.status!=="parsing",retry:3,retryDelay:s=>Math.min(1e3*2**s,5e3)}),F=x.technicalReports.uploads.applyReview.useMutation({onSuccess:s=>{u.success("Campo atualizado!",{description:s.remainingFields>0?`Ainda restam ${s.remainingFields} campos para revisar`:"Todos os campos foram revisados!"}),y.technicalReports.uploads.getReviewFields.invalidate({reportId:c}),y.technicalReports.generate.list.invalidate(),s.remainingFields===0&&setTimeout(()=>{u.success(" Revisão concluída!",{description:"O relatório está pronto para auditoria",action:{label:"Ir para Auditoria",onClick:()=>f("/reports/audit")}})},1e3)},onError:s=>{u.error("Erro ao salvar",{description:s.message})}}),A=async s=>{const o=N[s];if(o===void 0||o===""){u.error("Campo vazio",{description:"Preencha o campo antes de salvar"});return}try{await F.mutateAsync({reportId:c,updates:[{path:s,value:o}]}),E(t=>new Set(t).add(s)),setTimeout(()=>{h(t=>{const l={...t};return delete l[s],l})},1e3)}catch{}};if(n&&!a)return e.jsx(m,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:120",children:e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:121",className:"flex items-center justify-center h-64",children:e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:122",className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})});if(!a&&!n)return e.jsx(m,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:131",children:e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:132",className:"text-center py-12",children:e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:133",className:"text-gray-400",children:"Relatório não encontrado"})})});if(!i&&a?.status!=="parsing"&&!n)return e.jsx(m,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:143",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:144",className:"text-center py-12 space-y-4",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:145",className:"text-red-400 text-lg font-semibold",children:"Erro ao carregar dados de revisão"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:146",className:"text-gray-400 text-sm",children:k?.message?.includes("Normalized data not found")?"O arquivo normalizado ainda está sendo processado. Aguarde alguns segundos e recarregue a página.":"O processamento do relatório pode ter falhado. Verifique o status do relatório."}),e.jsx(v,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:151",onClick:()=>window.location.reload(),variant:"outline",children:"Recarregar Página"})]})});const g=i?.totalFields||0,C=b.size,d=g>0?C/g*100:0;return e.jsx(m,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:164",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:165",className:"space-y-6",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:166",children:[e.jsx("h1",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:167",className:"text-3xl font-bold",children:"Revisão Humana"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:168",className:"text-gray-400 mt-2",children:"Valide os campos extraídos automaticamente para garantir precisão"})]}),a?.status==="parsing"&&e.jsx(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:175",className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:176",className:"flex items-start gap-4",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:177",className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 flex-shrink-0 mt-1"}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:178",children:[e.jsx("h3",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:179",className:"font-semibold text-blue-900 mb-2",children:"Processamento em andamento..."}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:182",className:"text-sm text-blue-800",children:"O relatório está sendo analisado e os campos estão sendo extraídos. Esta página será atualizada automaticamente quando o processamento for concluído."})]})]})}),n&&a?.status!=="parsing"&&e.jsx(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:193",className:"p-6 bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-200",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:194",className:"flex items-start gap-4",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:195",className:"animate-spin rounded-full h-6 w-6 border-b-2 border-yellow-600 flex-shrink-0 mt-1"}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:196",children:[e.jsx("h3",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:197",className:"font-semibold text-yellow-900 mb-2",children:"Carregando campos de revisão..."}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:200",className:"text-sm text-yellow-800",children:"Tentando carregar os dados normalizados. Se o upload foi recente, o arquivo pode estar sendo finalizado."})]})]})}),a?.status==="parsing"&&e.jsx(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:210",className:"p-12",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:211",className:"flex flex-col items-center justify-center gap-4 text-center",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:212",className:"animate-pulse text-6xl",children:"⏳"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:213",className:"text-lg text-gray-600",children:"Aguardando conclusão do processamento..."}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:214",className:"text-sm text-gray-400",children:"Os campos aparecerão aqui automaticamente"})]})}),a?.status!=="parsing"&&i&&e.jsxs(e.Fragment,{children:[e.jsx(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:224",className:"p-6 bg-gradient-to-r from-orange-50 to-yellow-50 border-orange-200",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:225",className:"flex items-start gap-4",children:[e.jsx(T,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:226",className:"h-6 w-6 text-orange-600 flex-shrink-0 mt-1"}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:227",children:[e.jsx("h3",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:228",className:"font-semibold text-orange-900 mb-2",children:"Campos que precisam de validação humana"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:231",className:"text-sm text-orange-800",children:"Encontramos campos que não puderam ser extraídos com alta confiança. Revise as seções abaixo para garantir precisão e conformidade com os padrões internacionais."})]})]})}),e.jsxs(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:240",className:"p-6",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:241",className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:242",children:[e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:243",className:"text-sm text-gray-400",children:"Progresso da Revisão"}),e.jsxs("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:244",className:"text-2xl font-bold",children:[C," / ",g]})]}),e.jsxs(S,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:248",variant:d===100?"default":"secondary",children:[d.toFixed(0),"%"]})]}),e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:252",className:"bg-gray-200 rounded-full h-3",children:e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:253",className:"bg-[#2f2c79] h-3 rounded-full transition-all duration-500",style:{width:`${d}%`}})})]}),e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:261",className:"space-y-4",children:i.fieldsToReview.map((s,o)=>{const t=b.has(s.path),l=N[s.path]??"";return e.jsx(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:267",className:t?"border-green-500 bg-green-50":"",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:268",className:"p-6",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:269",className:"flex items-start justify-between mb-4",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:270",className:"flex-1",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:271",className:"flex items-center gap-2 mb-2",children:[e.jsxs(D,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:272",className:"text-base font-semibold",children:["Campo ",o+1]}),t&&e.jsxs(S,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:276",variant:"default",className:"bg-green-600",children:[e.jsx(j,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:277",className:"h-3 w-3 mr-1"}),"Salvo"]})]}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:282",className:"text-sm text-gray-400 mb-1",children:e.jsx("span",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:283",className:"font-mono text-xs bg-[#171a4a] px-2 py-1 rounded",children:s.path})}),e.jsxs("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:287",className:"text-sm text-orange-600 flex items-center gap-1",children:[e.jsx(T,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:288",className:"h-4 w-4"}),s.hint]})]})}),s.path.includes("contentText")||s.path.includes("content")?e.jsx(q,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:295",value:l,onChange:p=>h(R=>({...R,[s.path]:p.target.value})),placeholder:"Digite o conteúdo correto...",rows:4,disabled:t}):e.jsx(P,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:308",type:s.path.includes("tonnage")||s.path.includes("grade")?"number":"text",value:l,onChange:p=>h(R=>({...R,[s.path]:s.path.includes("tonnage")||s.path.includes("grade")?parseFloat(p.target.value):p.target.value})),placeholder:"Digite o valor correto...",disabled:t}),e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:324",className:"flex justify-end mt-4",children:e.jsx(v,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:325",onClick:()=>A(s.path),disabled:t||F.isPending,size:"sm",children:t?e.jsxs(e.Fragment,{children:[e.jsx(j,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:332",className:"h-4 w-4 mr-2"}),"Salvo"]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:337",className:"h-4 w-4 mr-2"}),"Salvar"]})})})]})},o)})}),d===100&&e.jsx(r,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:351",className:"p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:352",className:"flex items-center justify-between",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:353",className:"flex items-center gap-4",children:[e.jsx(j,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:354",className:"h-8 w-8 text-green-600"}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:355",children:[e.jsx("h3",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:356",className:"font-semibold text-green-900",children:"Revisão Concluída!"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:359",className:"text-sm text-green-800",children:"Todos os campos foram validados. O relatório está pronto para auditoria."})]})]}),e.jsxs(v,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:364",onClick:()=>f("/reports/audit"),children:["Ir para Auditoria",e.jsx(L,{"data-loc":"client/src/modules/technical-reports/pages/ReviewReport.tsx:366",className:"h-4 w-4 ml-2"})]})]})})]})]})})}export{K as default};
