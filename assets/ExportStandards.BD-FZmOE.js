import{j as e}from"./ui.CMOn6A-A.js";import{a}from"./vendor.DqptLLSw.js";import{D as V}from"./DashboardLayout.BMyonFam.js";import{t as W,e as f}from"./index.DqphIITB.js";import{u as G}from"./useApi.DSWxbJm1.js";import{C as H,z as A,l as Q,L as w,F as B,J as Y,K as Z,D as L,a as ee,e as te}from"./icons.2ttFni2B.js";import"./trpc.DEyng-9d.js";async function y(d,c=3,r=1e3){let i=null;for(let l=0;l<c;l++)try{return await d()}catch(p){if(i=p,console.error(`Tentativa ${l+1}/${c} falhou:`,p),l<c-1){const u=r*Math.pow(2,l);console.log(`Aguardando ${u}ms antes de tentar novamente...`),await new Promise(h=>setTimeout(h,u))}}throw i||new Error("Todas as tentativas falharam")}function $(){try{Object.keys(localStorage).forEach(r=>{(r.includes("export")||r.includes("trpc"))&&localStorage.removeItem(r)}),Object.keys(sessionStorage).forEach(r=>{(r.includes("export")||r.includes("trpc"))&&sessionStorage.removeItem(r)}),console.log("‚úÖ Cache limpo com sucesso")}catch(d){console.error("Erro ao limpar cache:",d)}}function de(){const{apiFetch:d}=G(),[c,r]=a.useState(""),[i,l]=a.useState("JORC_2012"),[p,u]=a.useState("PDF"),[h,q]=a.useState("pt-BR"),[z,X]=a.useState([]),[j,J]=a.useState([]),[C,R]=a.useState(!0),[b,F]=a.useState(!0),[n,T]=a.useState(!1),[v,g]=a.useState(0),[k,x]=a.useState(""),[E,D]=a.useState(0);a.useEffect(()=>{P(),S()},[]);const I=W.useUtils(),P=async()=>{try{R(!0),x("");const t=await y(async()=>await I.client.technicalReports.generate.list.query());X(t?.items||[])}catch(t){console.error("Erro ao carregar relat√≥rios:",t),x("N√£o foi poss√≠vel carregar a lista de relat√≥rios. Tente novamente."),f.error("Erro ao carregar relat√≥rios",{description:'Clique em "Tentar Novamente" para recarregar'})}finally{R(!1)}},S=async()=>{try{F(!0);const t=await y(async()=>await I.client.technicalReports.export.list.query());J(t||[])}catch(t){console.error("Erro ao carregar exporta√ß√µes:",t)}finally{F(!1)}},M=async()=>{if(!c){f.error("Selecione um relat√≥rio",{description:"Voc√™ precisa selecionar um relat√≥rio antes de exportar"});return}try{T(!0),g(0),x(""),D(0);const t=setInterval(()=>{g(m=>Math.min(m+10,90))},500),s=await y(async()=>(D(m=>m+1),await d("/api/technical-reports/exports/run",{method:"POST",body:JSON.stringify({reportId:c,toStandard:i,format:p,language:h})})),3,2e3);if(clearInterval(t),g(100),!s.ok){const m=await s.json().catch(()=>({}));throw new Error(m.message||"Erro ao exportar relat√≥rio")}const o=await s.json();f.success("Exporta√ß√£o conclu√≠da com sucesso!",{description:"O arquivo est√° pronto para download"}),await S(),r(""),g(0)}catch(t){console.error("Erro ao exportar:",t);let s="N√£o foi poss√≠vel exportar o relat√≥rio",o="";t.message.includes("network")||t.message.includes("fetch")?(s="Erro de conex√£o",o="Verifique sua conex√£o com a internet e tente novamente"):t.message.includes("timeout")?(s="Tempo esgotado",o="O servidor demorou muito para responder. Tente novamente"):t.message.includes("401")||t.message.includes("unauthorized")?(s="Sess√£o expirada",o="Fa√ßa login novamente para continuar"):t.message.includes("500")?(s="Erro no servidor",o="Ocorreu um erro interno. Nossa equipe foi notificada"):o=t.message||"Tente novamente ou entre em contato com o suporte",x(`${s}: ${o}`),f.error(s,{description:o,duration:5e3}),$()}finally{T(!1)}},_=()=>{$(),x(""),P(),S()},O=[{id:"JORC_2012",name:"JORC 2012",description:"Australasian Code",icon:"üá¶üá∫"},{id:"NI_43_101",name:"NI 43-101",description:"Canadian Standard",icon:"üá®üá¶"},{id:"PERC",name:"PERC",description:"Pan-European Code",icon:"üá™üá∫"},{id:"SAMREC",name:"SAMREC",description:"South African Code",icon:"üáøüá¶"},{id:"CBRR",name:"CBRR",description:"Brazilian Standard",icon:"üáßüá∑"}],N=[{id:"PDF",name:"PDF",icon:B,color:"text-red-600"},{id:"DOCX",name:"DOCX",icon:Y,color:"text-blue-600"},{id:"XLSX",name:"XLSX",icon:Z,color:"text-green-600"}],U=t=>{const s=N.find(o=>o.id===t);return s?s.icon:B},K=t=>N.find(o=>o.id===t)?.color||"text-gray-400";return e.jsx(V,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:261",children:e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:262",className:"p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:263",className:"mb-8",children:[e.jsx("h1",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:264",className:"text-3xl font-bold text-white mb-2",children:"Exportar Padr√µes"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:265",className:"text-gray-400",children:"Converta relat√≥rios entre padr√µes internacionais em m√∫ltiplos formatos"})]}),k&&e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:270",className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(H,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:271",className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:272",className:"flex-1",children:[e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:273",className:"text-sm text-red-800 font-medium mb-1",children:"Erro ao processar solicita√ß√£o"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:274",className:"text-sm text-red-700",children:k}),E>0&&e.jsxs("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:276",className:"text-xs text-red-600 mt-1",children:["Tentativas realizadas: ",E,"/3"]})]}),e.jsxs("button",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:281",onClick:_,className:"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 flex items-center gap-1",children:[e.jsx(A,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:285",className:"w-4 h-4"}),"Tentar Novamente"]})]}),e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:292",className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:O.map(t=>e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:294",className:"bg-white/5 rounded-lg shadow-sm border border-white/20 p-6 text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:298",className:"text-4xl mb-3",children:t.icon}),e.jsx("h3",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:299",className:"font-semibold text-white mb-1",children:t.name}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:300",className:"text-sm text-gray-400",children:t.description})]},t.id))}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:306",className:"bg-white/5 rounded-lg shadow-sm border border-white/20 p-6 mb-8",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:307",className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:308",className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Q,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:309",className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:311",children:[e.jsx("h2",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:312",className:"text-xl font-semibold text-white",children:"Nova Exporta√ß√£o"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:313",className:"text-sm text-gray-400",children:"Selecione o relat√≥rio e configure a exporta√ß√£o"})]})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:317",className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:319",children:[e.jsx("label",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:320",className:"block text-sm font-medium text-gray-300 mb-2",children:"Relat√≥rio de Origem"}),C?e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:324",className:"flex items-center justify-center py-2",children:e.jsx(w,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:325",className:"w-5 h-5 animate-spin text-purple-600"})}):e.jsxs("select",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:328",value:c,onChange:t=>r(t.target.value),className:"w-full px-4 py-2 border border-white/20 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:n,children:[e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:334",value:"",children:"Selecione um relat√≥rio..."}),z.map(t=>e.jsxs("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:336",value:t.id,children:[t.title," (",t.standard,") - ",t.status]},t.id))]})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:345",children:[e.jsx("label",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:346",className:"block text-sm font-medium text-gray-300 mb-2",children:"Padr√£o de Destino"}),e.jsx("select",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:349",value:i,onChange:t=>l(t.target.value),className:"w-full px-4 py-2 border border-white/20 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:n,children:O.map(t=>e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:356",value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:364",children:[e.jsx("label",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:365",className:"block text-sm font-medium text-gray-300 mb-2",children:"Formato de Exporta√ß√£o"}),e.jsx("select",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:368",value:p,onChange:t=>u(t.target.value),className:"w-full px-4 py-2 border border-white/20 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:n,children:N.map(t=>e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:375",value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:383",children:[e.jsx("label",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:384",className:"block text-sm font-medium text-gray-300 mb-2",children:"Idioma do Relat√≥rio"}),e.jsxs("select",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:387",value:h,onChange:t=>q(t.target.value),className:"w-full px-4 py-2 border border-white/20 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:n,children:[e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:393",value:"pt-BR",children:"üáßüá∑ Portugu√™s (Brasil)"}),e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:394",value:"en-US",children:"üá∫üá∏ English (US)"}),e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:395",value:"es-ES",children:"üá™üá∏ Espa√±ol"}),e.jsx("option",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:396",value:"fr-FR",children:"üá´üá∑ Fran√ßais"})]}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:398",className:"text-xs text-gray-400 mt-1",children:"Define o idioma do relat√≥rio exportado"})]})]}),n&&e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:406",className:"mb-6",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:407",className:"flex items-center justify-between mb-2",children:[e.jsx("span",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:408",className:"text-sm font-medium text-gray-300",children:"Progresso da exporta√ß√£o"}),e.jsxs("span",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:409",className:"text-sm text-gray-400",children:[v,"%"]})]}),e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:411",className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:412",className:"bg-purple-600 h-2 rounded-full transition-all duration-500",style:{width:`${v}%`}})}),E>1&&e.jsxs("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:418",className:"text-xs text-amber-600 mt-2",children:["‚ö†Ô∏è Tentativa ",E,"/3 - Aguarde..."]})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:425",className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[e.jsxs("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:426",className:"text-sm text-amber-800",children:["‚è±Ô∏è ",e.jsx("strong",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:427",children:"Tempo estimado:"})," 30-60 segundos para gera√ß√£o do arquivo"]}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:429",className:"text-xs text-amber-700 mt-1",children:"üí° Em caso de erro, o sistema tentar√° automaticamente at√© 3 vezes"})]}),e.jsx("button",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:434",onClick:M,disabled:n||!c||C,className:"w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-colors",children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:441",className:"w-5 h-5 animate-spin"}),"Exportando... (",v,"%)"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:446",className:"w-5 h-5"}),"Iniciar Exporta√ß√£o"]})})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:454",className:"bg-white/5 rounded-lg shadow-sm border border-white/20 p-6",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:455",className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:456",className:"text-xl font-semibold text-white",children:"Exporta√ß√µes Recentes"}),e.jsxs("button",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:457",onClick:S,disabled:b,className:"px-3 py-1 text-sm text-purple-600 hover:text-purple-700 flex items-center gap-1",children:[e.jsx(A,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:462",className:`w-4 h-4 ${b?"animate-spin":""}`}),"Atualizar"]})]}),b?e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:468",className:"flex items-center justify-center py-12",children:e.jsx(w,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:469",className:"w-8 h-8 animate-spin text-purple-600"})}):j&&j.length>0?e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:472",className:"space-y-3",children:j.map(t=>{const s=U(t.format);return e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:476",className:"flex items-center justify-between p-4 border border-white/20 rounded-lg hover:bg-[#000020] transition-colors",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:480",className:"flex items-center gap-4",children:[e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:481",className:`p-2 bg-[#171a4a] rounded-lg ${K(t.format)}`,children:e.jsx(s,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:482",className:"w-5 h-5"})}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:484",children:[e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:485",className:"font-medium text-white",children:[t.fromStandard," ‚Üí ",t.toStandard]}),e.jsx("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:488",className:"text-sm text-gray-400",children:new Date(t.createdAt).toLocaleString("pt-BR")})]})]}),e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:493",className:"flex items-center gap-3",children:[e.jsxs("span",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:494",className:"flex items-center gap-1 text-sm text-green-600 font-medium",children:[e.jsx(ee,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:495",className:"w-4 h-4"}),"Conclu√≠do"]}),e.jsxs("a",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:498",href:t.s3Url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(L,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:504",className:"w-4 h-4"}),"Baixar ",t.format]})]})]},t.id)})}):e.jsxs("div",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:513",className:"text-center py-12",children:[e.jsx(te,{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:514",className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:515",className:"text-gray-400",children:"Nenhuma exporta√ß√£o realizada ainda"}),e.jsx("p",{"data-loc":"client/src/modules/technical-reports/pages/ExportStandards.tsx:516",className:"text-sm text-gray-500 mt-1",children:"Selecione um relat√≥rio acima para come√ßar"})]})]})]})})}export{de as default};
