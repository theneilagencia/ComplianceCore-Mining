import{j as s}from"./ui.CMOn6A-A.js";import{u as $,a as i}from"./vendor.DqptLLSw.js";import{L as g,C as E,m as I,d as A,n as _,o as z,D as B,E as M}from"./icons.2ttFni2B.js";const o="",C={START:"Start (Gratuito)",PRO:"PRO",ENTERPRISE:"Enterprise"},V={PRO:{monthly:899,annual:9600},ENTERPRISE:{monthly:1990,annual:21e3}},G={active:"bg-green-100 text-green-800",trialing:"bg-blue-100 text-blue-800",past_due:"bg-yellow-100 text-yellow-800",canceled:"bg-red-100 text-red-800",unpaid:"bg-red-100 text-red-800"},q={active:"Ativa",trialing:"Período de teste",past_due:"Pagamento atrasado",canceled:"Cancelada",unpaid:"Não paga"};function Q(){const[,p]=$(),[L,R]=i.useState(!0),[m,T]=i.useState(null),[b,k]=i.useState([]),[h,D]=i.useState(null),[S,j]=i.useState(!1),[d,f]=i.useState(!1),[N,y]=i.useState(!1);i.useEffect(()=>{x(),U()},[]);const x=async()=>{try{const t=await fetch(`${o}/api/license/subscription`,{credentials:"include"});if(!t.ok)throw new Error("Falha ao carregar dados da assinatura");const c=await t.json();T(c)}catch(t){D(t.message)}finally{R(!1)}},U=async()=>{try{const t=await fetch(`${o}/api/license/invoices`,{credentials:"include"});if(t.ok){const c=await t.json();k(c.invoices||[])}}catch(t){console.error("Failed to fetch invoices:",t)}},F=async()=>{if(confirm("Tem certeza que deseja cancelar sua assinatura? Você continuará tendo acesso até o final do período atual.")){j(!0);try{if(!(await fetch(`${o}/api/license/cancel`,{method:"POST",credentials:"include"})).ok)throw new Error("Falha ao cancelar assinatura");alert("Assinatura cancelada com sucesso!"),x()}catch(t){alert(t.message)}finally{j(!1)}}},w=async(t,c)=>{if(confirm(`Deseja alterar para o plano ${C[t]} ${c==="monthly"?"Mensal":"Anual"}?`)){f(!0);try{if(!(await fetch(`${o}/api/license/change-plan`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({plan:t,billingPeriod:c})})).ok)throw new Error("Falha ao alterar plano");alert("Plano alterado com sucesso!"),x()}catch(P){alert(P.message)}finally{f(!1)}}},O=async()=>{y(!0);try{const t=await fetch(`${o}/api/license/portal`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error("Falha ao abrir portal");const c=await t.json();window.location.href=c.url}catch(t){alert(t.message),y(!1)}},l=t=>new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"}),v=(t,c)=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:c||"USD"}).format(t);if(L)return s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:229",className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:230",className:"text-center",children:[s.jsx(g,{"data-loc":"client/src/pages/Subscription.tsx:231",className:"w-12 h-12 animate-spin text-purple-600 mx-auto mb-4"}),s.jsx("p",{"data-loc":"client/src/pages/Subscription.tsx:232",className:"text-gray-400",children:"Carregando informações da assinatura..."})]})});if(h||!m)return s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:240",className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center p-4",children:s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:241",className:"bg-white/5 rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[s.jsx(E,{"data-loc":"client/src/pages/Subscription.tsx:242",className:"w-16 h-16 text-red-500 mx-auto mb-4"}),s.jsx("h2",{"data-loc":"client/src/pages/Subscription.tsx:243",className:"text-2xl font-bold text-slate-800 mb-2",children:"Erro ao Carregar"}),s.jsx("p",{"data-loc":"client/src/pages/Subscription.tsx:244",className:"text-gray-400 mb-6",children:h||"Não foi possível carregar os dados da assinatura"}),s.jsx("button",{"data-loc":"client/src/pages/Subscription.tsx:245",onClick:()=>p("/dashboard"),className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Voltar ao Dashboard"})]})});const{license:r,subscription:a,stats:e}=m,n=r.plan==="START";a?.status;const u=a?.cancelAtPeriodEnd;return s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:262",className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:264",className:"bg-white/5 border-b border-white/20",children:s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:265",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:266",className:"flex items-center justify-between",children:s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:267",className:"flex items-center gap-4",children:[s.jsx("button",{"data-loc":"client/src/pages/Subscription.tsx:268",onClick:()=>p("/dashboard"),className:"p-2 hover:bg-[#171a4a] rounded-lg transition",children:s.jsx(I,{"data-loc":"client/src/pages/Subscription.tsx:272",className:"w-5 h-5 text-gray-400"})}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:274",children:[s.jsx("h1",{"data-loc":"client/src/pages/Subscription.tsx:275",className:"text-3xl font-bold text-white",children:"Gerenciar Assinatura"}),s.jsx("p",{"data-loc":"client/src/pages/Subscription.tsx:276",className:"text-gray-400 mt-1",children:"Visualize e gerencie seu plano e faturas"})]})]})})})}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:283",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:284",className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:286",className:"lg:col-span-2 bg-white/5 rounded-xl shadow-sm border border-white/20 p-6",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:287",className:"flex items-start justify-between mb-6",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:288",children:[s.jsxs("h2",{"data-loc":"client/src/pages/Subscription.tsx:289",className:"text-2xl font-bold text-white mb-2",children:["Plano ",C[r.plan]]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:292",className:"flex items-center gap-2",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:293",className:`px-3 py-1 rounded-full text-sm font-medium ${G[a?.status||"active"]}`,children:q[a?.status||"active"]}),u&&s.jsxs("span",{"data-loc":"client/src/pages/Subscription.tsx:301",className:"px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:["Cancela em ",l(a.currentPeriodEnd)]})]})]}),!n&&s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:308",className:"text-right",children:[s.jsx("p",{"data-loc":"client/src/pages/Subscription.tsx:309",className:"text-3xl font-bold text-white",children:v(V[r.plan]?.[r.billingPeriod]||0,"USD")}),s.jsxs("p",{"data-loc":"client/src/pages/Subscription.tsx:315",className:"text-sm text-gray-400",children:["/",r.billingPeriod==="monthly"?"mês":"ano"]})]})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:323",className:"grid grid-cols-2 gap-4 mb-6",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:324",className:"bg-[#000020] rounded-lg p-4",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:325",className:"flex items-center justify-between mb-2",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:326",className:"text-sm font-medium text-gray-400",children:"Relatórios"}),s.jsx(A,{"data-loc":"client/src/pages/Subscription.tsx:327",className:"w-4 h-4 text-purple-600"})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:329",className:"flex items-baseline gap-1",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:330",className:"text-2xl font-bold text-white",children:e.reportsUsed}),s.jsxs("span",{"data-loc":"client/src/pages/Subscription.tsx:331",className:"text-sm text-gray-400",children:["/ ",e.reportsLimit===-1?"∞":e.reportsLimit]})]}),s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:335",className:"mt-2 bg-slate-200 rounded-full h-2",children:s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:336",className:"bg-purple-600 h-2 rounded-full transition-all",style:{width:`${e.reportsLimit===-1?0:Math.min(e.reportsUsed/e.reportsLimit*100,100)}%`}})})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:349",className:"bg-[#000020] rounded-lg p-4",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:350",className:"flex items-center justify-between mb-2",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:351",className:"text-sm font-medium text-gray-400",children:"Projetos Ativos"}),s.jsx(_,{"data-loc":"client/src/pages/Subscription.tsx:352",className:"w-4 h-4 text-green-600"})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:354",className:"flex items-baseline gap-1",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:355",className:"text-2xl font-bold text-white",children:e.projectsActive}),s.jsxs("span",{"data-loc":"client/src/pages/Subscription.tsx:356",className:"text-sm text-gray-400",children:["/ ",e.projectsLimit===-1?"∞":e.projectsLimit]})]}),s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:360",className:"mt-2 bg-slate-200 rounded-full h-2",children:s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:361",className:"bg-green-600 h-2 rounded-full transition-all",style:{width:`${e.projectsLimit===-1?0:Math.min(e.projectsActive/e.projectsLimit*100,100)}%`}})})]})]}),a&&s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:377",className:"border-t border-white/20 pt-6",children:[s.jsx("h3",{"data-loc":"client/src/pages/Subscription.tsx:378",className:"text-lg font-semibold text-white mb-4",children:"Detalhes da Assinatura"}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:379",className:"space-y-3",children:[s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:380",className:"flex justify-between",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:381",className:"text-gray-400",children:"Período atual"}),s.jsxs("span",{"data-loc":"client/src/pages/Subscription.tsx:382",className:"font-medium text-white",children:[l(a.currentPeriodStart)," - ",l(a.currentPeriodEnd)]})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:386",className:"flex justify-between",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:387",className:"text-gray-400",children:"Próxima cobrança"}),s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:388",className:"font-medium text-white",children:u?"Não haverá":l(a.currentPeriodEnd)})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:392",className:"flex justify-between",children:[s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:393",className:"text-gray-400",children:"ID da Assinatura"}),s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:394",className:"font-mono text-sm text-gray-400",children:a.id})]})]})]}),s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:401",className:"border-t border-white/20 pt-6 mt-6",children:s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:402",className:"flex flex-wrap gap-3",children:[!n&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{"data-loc":"client/src/pages/Subscription.tsx:405",onClick:O,disabled:N,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition disabled:opacity-50",children:[N?s.jsx(g,{"data-loc":"client/src/pages/Subscription.tsx:411",className:"w-4 h-4 animate-spin"}):s.jsx(z,{"data-loc":"client/src/pages/Subscription.tsx:413",className:"w-4 h-4"}),"Gerenciar Pagamento"]}),!u&&s.jsxs("button",{"data-loc":"client/src/pages/Subscription.tsx:418",onClick:F,disabled:S,className:"flex items-center gap-2 px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition disabled:opacity-50",children:[S?s.jsx(g,{"data-loc":"client/src/pages/Subscription.tsx:423",className:"w-4 h-4 animate-spin"}):s.jsx(E,{"data-loc":"client/src/pages/Subscription.tsx:423",className:"w-4 h-4"}),"Cancelar Assinatura"]})]}),s.jsxs("button",{"data-loc":"client/src/pages/Subscription.tsx:429",onClick:()=>p("/pricing"),className:"flex items-center gap-2 px-4 py-2 border border-slate-300 text-gray-300 rounded-lg hover:bg-[#000020] transition",children:[s.jsx(A,{"data-loc":"client/src/pages/Subscription.tsx:433",className:"w-4 h-4"}),n?"Fazer Upgrade":"Alterar Plano"]})]})})]}),s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:441",className:"space-y-6",children:[!n&&r.plan==="PRO"&&s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:444",className:"bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl shadow-sm p-6 text-white",children:[s.jsx("h3",{"data-loc":"client/src/pages/Subscription.tsx:445",className:"text-lg font-semibold mb-2",children:"Upgrade para Enterprise"}),s.jsx("p",{"data-loc":"client/src/pages/Subscription.tsx:446",className:"text-purple-100 text-sm mb-4",children:"Projetos ilimitados, API completa e suporte 24/7"}),s.jsx("button",{"data-loc":"client/src/pages/Subscription.tsx:449",onClick:()=>w("ENTERPRISE",r.billingPeriod),disabled:d,className:"w-full px-4 py-2 bg-white/5 text-purple-600 rounded-lg hover:bg-purple-50 transition font-medium disabled:opacity-50",children:d?"Processando...":"Fazer Upgrade"})]}),!n&&r.billingPeriod==="monthly"&&s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:461",className:"bg-green-50 border border-green-200 rounded-xl p-6",children:[s.jsx("h3",{"data-loc":"client/src/pages/Subscription.tsx:462",className:"text-lg font-semibold text-green-900 mb-2",children:"Economize 12%"}),s.jsx("p",{"data-loc":"client/src/pages/Subscription.tsx:463",className:"text-green-700 text-sm mb-4",children:"Mude para cobrança anual e economize!"}),s.jsx("button",{"data-loc":"client/src/pages/Subscription.tsx:464",onClick:()=>w(r.plan,"annual"),disabled:d,className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium disabled:opacity-50",children:d?"Processando...":"Mudar para Anual"})]})]})]}),b.length>0&&s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:478",className:"mt-8 bg-white/5 rounded-xl shadow-sm border border-white/20 p-6",children:[s.jsx("h2",{"data-loc":"client/src/pages/Subscription.tsx:479",className:"text-2xl font-bold text-white mb-6",children:"Histórico de Faturas"}),s.jsx("div",{"data-loc":"client/src/pages/Subscription.tsx:480",className:"overflow-x-auto",children:s.jsxs("table",{"data-loc":"client/src/pages/Subscription.tsx:481",className:"w-full",children:[s.jsx("thead",{"data-loc":"client/src/pages/Subscription.tsx:482",children:s.jsxs("tr",{"data-loc":"client/src/pages/Subscription.tsx:483",className:"border-b border-white/20",children:[s.jsx("th",{"data-loc":"client/src/pages/Subscription.tsx:484",className:"text-left py-3 px-4 text-sm font-semibold text-gray-300",children:"Data"}),s.jsx("th",{"data-loc":"client/src/pages/Subscription.tsx:485",className:"text-left py-3 px-4 text-sm font-semibold text-gray-300",children:"Número"}),s.jsx("th",{"data-loc":"client/src/pages/Subscription.tsx:486",className:"text-left py-3 px-4 text-sm font-semibold text-gray-300",children:"Status"}),s.jsx("th",{"data-loc":"client/src/pages/Subscription.tsx:487",className:"text-right py-3 px-4 text-sm font-semibold text-gray-300",children:"Valor"}),s.jsx("th",{"data-loc":"client/src/pages/Subscription.tsx:488",className:"text-right py-3 px-4 text-sm font-semibold text-gray-300",children:"Ações"})]})}),s.jsx("tbody",{"data-loc":"client/src/pages/Subscription.tsx:491",children:b.map(t=>s.jsxs("tr",{"data-loc":"client/src/pages/Subscription.tsx:493",className:"border-b border-slate-100 hover:bg-[#000020]",children:[s.jsx("td",{"data-loc":"client/src/pages/Subscription.tsx:494",className:"py-4 px-4 text-sm text-white",children:l(t.created)}),s.jsx("td",{"data-loc":"client/src/pages/Subscription.tsx:495",className:"py-4 px-4 text-sm font-mono text-gray-400",children:t.number||"-"}),s.jsx("td",{"data-loc":"client/src/pages/Subscription.tsx:496",className:"py-4 px-4",children:s.jsx("span",{"data-loc":"client/src/pages/Subscription.tsx:497",className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="paid"?"bg-green-100 text-green-800":t.status==="open"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status==="paid"?"Paga":t.status==="open"?"Aberta":"Não paga"})}),s.jsx("td",{"data-loc":"client/src/pages/Subscription.tsx:509",className:"py-4 px-4 text-sm font-semibold text-white text-right",children:v(t.amount,t.currency)}),s.jsx("td",{"data-loc":"client/src/pages/Subscription.tsx:512",className:"py-4 px-4 text-right",children:s.jsxs("div",{"data-loc":"client/src/pages/Subscription.tsx:513",className:"flex items-center justify-end gap-2",children:[t.pdfUrl&&s.jsx("a",{"data-loc":"client/src/pages/Subscription.tsx:515",href:t.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-[#171a4a] rounded-lg transition",title:"Baixar PDF",children:s.jsx(B,{"data-loc":"client/src/pages/Subscription.tsx:522",className:"w-4 h-4 text-gray-400"})}),t.hostedUrl&&s.jsx("a",{"data-loc":"client/src/pages/Subscription.tsx:526",href:t.hostedUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-[#171a4a] rounded-lg transition",title:"Ver fatura",children:s.jsx(M,{"data-loc":"client/src/pages/Subscription.tsx:533",className:"w-4 h-4 text-gray-400"})})]})})]},t.id))})]})})]})]})]})}export{Q as default};
